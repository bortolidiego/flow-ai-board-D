ALTER TABLE public.card_analysis_history
  ADD COLUMN IF NOT EXISTS conversation_length INTEGER,
  ADD COLUMN IF NOT EXISTS conversation_status TEXT,
  ADD COLUMN IF NOT EXISTS conversation_summary TEXT,
  ADD COLUMN IF NOT EXISTS custom_fields_snapshot JSONB,
  ADD COLUMN IF NOT EXISTS funnel_score INTEGER,
  ADD COLUMN IF NOT EXISTS funnel_type TEXT,
  ADD COLUMN IF NOT EXISTS lead_data_snapshot JSONB,
  ADD COLUMN IF NOT EXISTS lifecycle_progress_percent INTEGER,
  ADD COLUMN IF NOT EXISTS lifecycle_stage_at_analysis TEXT,
  ADD COLUMN IF NOT EXISTS loss_reason TEXT,
  ADD COLUMN IF NOT EXISTS model_used TEXT,
  ADD COLUMN IF NOT EXISTS product_item TEXT,
  ADD COLUMN IF NOT EXISTS service_quality_score INTEGER,
  ADD COLUMN IF NOT EXISTS service_quality_suggestions JSONB,
  ADD COLUMN IF NOT EXISTS subject TEXT,
  ADD COLUMN IF NOT EXISTS trigger_source TEXT,
  ADD COLUMN IF NOT EXISTS value NUMERIC,
  ADD COLUMN IF NOT EXISTS win_confirmation TEXT;